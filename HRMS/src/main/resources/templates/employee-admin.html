<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Employees - Xammer HRMS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
          integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <style>
        :root {
            --primary: #FF8F00; /* Updated to #FF8F00 for orange accents */
            --primary-dark: #E68A00; /* Slightly darker orange for hover/active states */
            --dark: #000000; /* Darker background for overall theme */
            --darker: #1413138f; /* Even darker for some elements like sidebar/cards */
            --light: #E0E0E0; /* Light text color for readability */
            --lighter: #F5F5F5;
            --gray: #161616; /* A medium dark gray for card backgrounds, inputs */
            --light-gray: #424242; /* A lighter gray for borders, secondary text */
            --text-primary: #E0E0E0; /* Primary text color */
            --text-secondary: #B0B0B0; /* Secondary text color */
        }
* {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #121212;
            color: #E0E0E0;
            display: flex;
            overflow: hidden; /* Prevent scrolling of the main page */
            height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .sidebar-toggle-button {
            position: fixed;
            top: 1.0rem;
            left: 1rem;
            background: none;
            border: none;
            color: #FF8F00;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1001; /* Ensure it's above the sidebar */
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none; /* Hidden by default */
            transition: opacity 0.3s ease;
        }

        .sidebar {
            width: 260px;
            background-color: #1E1E1E;
            padding: 2rem 1.5rem;
            position: fixed;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border-right: 1px solid #303030;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            left: -260px; /* Initially hidden */
            transition: left 0.3s ease;
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar img {
            max-width: 150px;
            height: auto;
            margin-bottom: 2.5rem;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .nav-links {
            margin-top: 1rem;
        }

        .nav-links a {
            display: flex;
            align-items: center;
            padding: 0.8rem 1.2rem;
            color: #BDBDBD;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 0.6rem;
            font-weight: 500;
            transition: all 0.3s ease;
            background-color: #1E1E1E; /* Added background color for consistency */
        }

        .nav-links a i {
            margin-right: 0.75rem;
            font-size: 1.1rem;
            color: #9E9E9E;
        }

        .nav-links a:hover {
            background-color: #2C2C2C;
            color: #FF8F00;
            box-shadow: 3px 3px 10px rgba(255, 143, 0, 0.25);
            transform: translateX(4px);
        }

        .logout {
            background: linear-gradient(to right, #FF8F00, #F57C00);
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .logout:hover {
            background: linear-gradient(to right, #F57C00, #FF8F00);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            transform: scale(1.02);
        }

        .main {
            margin-left: 0; /* Initially no margin */
            padding: 2.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center content horizontally */
            transition: margin-left 0.3s ease;
        }

        .main.sidebar-open {
            margin-left: 260px;
        }


        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            transition: all 0.2s ease;
            font-weight: 600;
            letter-spacing: 0.5px;
            border: none; /* Ensure no default button borders */
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(255, 143, 0, 0.4); /* Enhanced shadow */
        }
        .search-results {
            max-height: 300px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--gray);
            list-style: none;
            padding: 0;
            margin: 0;
            background-color: var(--gray); /* Background for search results */
            border: 1px solid var(--light-gray);
            border-top: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .search-results::-webkit-scrollbar {
            width: 6px;
        }
        .search-results::-webkit-scrollbar-track {
            background: var(--gray);
        }
        .search-results::-webkit-scrollbar-thumb {
            background-color: var(--primary);
            border-radius: 3px;
        }
        .search-results li {
            padding: 0.75rem 1rem;
            cursor: pointer;
            color: var(--text-primary);
        }
        .search-results li:hover, .search-results li.active-suggestion {
            background-color: var(--primary);
            color: white;
        }
        .table-container {
            background: linear-gradient(145deg, var(--gray), var(--darker)); /* Adjusted for consistency */
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border-radius: 12px; /* Consistent border-radius */
        }
        .table-header {
            background: linear-gradient(180deg, #3A3A3A, #2B2B2B); /* Darker header for tables */
        }
        .table-row:hover {
            background-color: rgba(255, 143, 0, 0.08) !important; /* Slightly more visible hover */
        }
        .badge-success {
            background-color: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }
        .badge-warning {
            background-color: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }
        .badge-danger {
            background-color: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }
        .badge-info {
            background-color: rgba(0, 0, 0, 0.938);
            color: #2196f3;
        }
        .search-input, .form-input { /* Combined for consistency */
            background-color: var(--gray);
            border: 1px solid var(--light-gray);
            color: var(--text-primary);
            padding: 0.75rem 1rem; /* Consistent padding */
            border-radius: 0.5rem; /* Consistent border-radius */
        }
        .search-input:focus, .form-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 143, 0, 0.3); /* More noticeable focus ring */
            outline: none;
        }
        .title-text {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-shadow: 0 0 10px rgba(255, 143, 0, 0.7); /* Stronger glow for titles */
        }
        .action-btn {
            transition: all 0.2s ease;
        }
        .action-btn:hover {
            transform: translateY(-2px) scale(1.05); /* Slight lift and scale */
            box-shadow: 0 4px 10px rgba(255, 143, 0, 0.2);
        }
        /* .sidebar-toggle {
            position: fixed;
            left: 20px;
            top: 20px;
            z-index: 40;
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid var(--gray);
            color: var(--primary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .sidebar-toggle:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.1) rotate(5deg); /* Added a subtle rotation */
        /* }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6); Darker overlay */
            /* z-index: 40;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .sidebar-open .overlay {
            opacity: 1;
            pointer-events: auto;
        }  */
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            border: 2px solid var(--primary); /* Added a border */
        }
        .employee-card {
            background: linear-gradient(145deg, var(--gray), var(--darker)); /* Darker, more textured background */
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3); /* Slightly larger shadow */
            border: 1px solid rgba(255, 143, 0, 0.1); /* Subtle orange border */
        }
        .employee-card:hover {
            transform: translateY(-6px); /* More pronounced lift */
            box-shadow: 0 12px 28px rgba(255, 143, 0, 0.3); /* Larger, more orange shadow */
            border-color: var(--primary); /* Solid orange border on hover */
        }
        .employee-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 2rem;
            margin: 0 auto;
            border: 3px solid var(--primary); /* Prominent orange border */
        }
        .pagination-btn {
            background-color: var(--gray);
            color: var(--text-primary);
            transition: all 0.2s ease;
            border: 1px solid var(--light-gray);
        }
        .pagination-btn:hover {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        .pagination-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        .status-active {
            background-color: rgba(76, 175, 80, 0.15); /* Slightly more opaque */
            color: #4caf50;
        }
        .status-inactive {
            background-color: rgba(244, 67, 54, 0.15);
            color: #f44336;
        }
        .status-pending {
            background-color: rgba(255, 193, 7, 0.15);
            color: #ffc107;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.973); /* Even darker overlay for modals */
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            background: linear-gradient(145deg, var(--gray), var(--darker)); /* Consistent modal background */
            border-radius: 12px;
            width: 90%;
            max-width: 650px; /* Slightly wider modal */
            transform: translateY(30px); /* More pronounced initial translateY */
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* Smoother transition */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6); /* Larger shadow */
            border: 1px solid var(--light-gray);
        }
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }
        .attendance-present {
            background-color: rgba(76, 175, 80, 0.15);
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.3); /* Subtle border for attendance cards */
        }
        .attendance-absent {
            background-color: rgba(244, 67, 54, 0.15);
            color: #f44336;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }
        /* Additional styling for better typography and spacing */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            color: var(--text-primary);
        }
        p, span, label {
            color: var(--text-secondary);
        }
        .text-orange-400 { /* Replaced specific Tailwind color with primary variable where appropriate */
             color: var(--primary);
        }
        .bg-gray-900 { /* Replaced specific Tailwind background with darker variable */
            background-color: var(--darker);
        }
        .bg-gray-800 { /* Replaced specific Tailwind background with gray variable */
            background-color: var(--gray);
        }
        .border-gray-800 { /* Replaced specific Tailwind border with gray variable */
            border-color: var(--gray);
        }
        .border-gray-700 {
            border-color: var(--light-gray);
        }
                .header-welcome h1 {
            font-size: 1.8rem;
            color: #FFFFFF;
            margin: 0; /* Remove default margins */
            font-weight: 700;
            letter-spacing: -1px;
            line-height: 1;
        }
             .header-right {
            position: fixed;
            top: 3rem;
            right: 1rem;
            color: #9E9E9E;
            font-size: 0.9rem;
        }



        
        .header {
            margin-top: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: center; /* Center the welcome section */
            align-items: center; /* Align items vertically in the header */
            position: relative; /* For absolute positioning of time */
            width: 100%; /* Ensure header takes full width */
        }
    </style>
</head>
<button class="sidebar-toggle-button" onclick="toggleSidebar()">
    <i class="fa-solid fa-bars"></i>
</button>
<div class="sidebar-overlay" onclick="closeSidebar()"></div>
<div class="sidebar">
    <div>
        <img src="/images/xammer_logo.png" alt="Xammer HRMS Logo">
        <div class="nav-links">
            <a href="/admin/dashboard" class="active"><i class="fa-solid fa-gauge-high"></i> Dashboard</a>
            <a href="/admin/employees"><i class="fa-solid fa-users"></i> Employees</a>
            <a href="/admin/attendance"><i class="fa-solid fa-calendar-check"></i> Attendance</a>
             <a href="/admin/requests/pending"><i class="fa fa-calendar-check"></i> Team Requests</a>

            <!-- <a href="#"><i class="fa-solid fa-chart-bar"></i> Analytics</a> -->
            <!-- <a href="#"><i class="fa-solid fa-cog"></i> Settings</a> -->
        </div>
    </div>
    <div class="logout" onclick="confirmLogout()">
        <i class="fa-solid fa-right-from-bracket"></i> Logout
    </div>
</div>

        <!-- <div class="px-4 py-6">
            <form action="/logout" method="post" onsubmit="return confirmLogout();">
                <button type="submit" class="btn-primary w-full py-3 px-4 rounded-lg flex items-center justify-center font-medium">
                    <i class="bi bi-box-arrow-left mr-2"></i>
                    Logout
                </button>
            </form>
        </div> -->
    <!-- </div> -->


    <!-- <div class="main"> -->
    <div class="flex-1 flex flex-col overflow-hidden h-full ml-0 transition-all duration-300 sidebar-open:ml-64">

   
    <div class="header">
        <div class="header-welcome">
            <h1 th:text="${'EMPLOYEE MANAGEMENT ' + ' 👋'}">EMPLOYEE MANGEMENT 👋</h1>
        </div>
        </div>

    <div class="flex-1 overflow-y-auto p-6">
        <div class="bg-gray-1000 rounded-xl p-6 mb-6 shadow-lg">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="md:col-span-2">
                    <label for="employeeSearch" class="block text-sm font-medium text-gray-400 mb-1 tracking-wide">SEARCH EMPLOYEES</label>
                    <div class="relative">
                        <input type="text" id="searchUser" placeholder="Type to search employees..."
                               class="search-input w-full px-4 py-3 rounded-lg bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-orange-500"
                               onkeyup="suggestUsers(this.value)">

                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <i class="bi bi-search text-gray-500"></i>
                        </div>
                    </div>
                    <ul id="employeeSearchResults" class="search-results absolute z-10 mt-1 w-full bg-gray-800 rounded-lg shadow-lg hidden max-h-60 overflow-y-auto border border-gray-700"></ul>
                </div>

                <div>
                    <label for="filterDepartment" class="block text-sm font-medium text-gray-400 mb-1 tracking-wide">DEPARTMENT</label>
                    <select id="filterDepartment" class="search-input w-full px-4 py-3 rounded-lg bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-orange-500">
                        <option value="">All Departments</option>
                        <option value="DevOps">DevOps</option>
                        <option value="Business">Business</option>
                        <option value="Marketing">Marketing</option>
                    </select>
                </div>

                <div class="flex items-end">
                    <button onclick="filterEmployees()" class="btn-primary w-full py-3 px-4 rounded-lg flex items-center justify-center font-medium tracking-wide">
                        <i class="bi bi-funnel-fill mr-2"></i>
                        FILTER
                    </button>
                    <button onclick="openAddEmployeeModal()" class="btn-primary w-full py-3 px-4 rounded-lg flex items-center justify-center font-medium tracking-wide ml-2">
                        <i class="bi bi-plus-circle mr-2"></i>
                        ADD
                    </button>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-6" id="employeeCardsContainer">
            </div>

        <div class="flex justify-center mt-6">
            <nav class="inline-flex rounded-md shadow">
                <button class="pagination-btn px-3 py-1 rounded-l-md" onclick="changePage(-1)">
                    <i class="bi bi-chevron-left"></i>
                </button>
                <button class="pagination-btn px-3 py-1 border-l border-gray-700 active">1</button>
                <button class="pagination-btn px-3 py-1 border-l border-gray-700">2</button>
                <button class="pagination-btn px-3 py-1 border-l border-gray-700">3</button>
                <button class="pagination-btn px-3 py-1 border-l border-gray-700 rounded-r-md" onclick="changePage(1)">
                    <i class="bi bi-chevron-right"></i>
                </button>
            </nav>
        </div>
    </div>
</div>

<div class="modal-overlay" id="addEmployeeModal">
    <div class="modal-content">
        <div class="p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-orange-400">Add New Employee</h3>
                <button onclick="closeAddEmployeeModal()" class="text-gray-400 hover:text-white">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>

            <form id="addEmployeeForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="firstName" class="block text-sm font-medium text-gray-400 mb-1">First Name</label>
                        <input type="text" id="firstName" class="form-input w-full px-4 py-2 rounded-lg">
                    </div>
                    <div>
                        <label for="lastName" class="block text-sm font-medium text-gray-400 mb-1">Last Name</label>
                        <input type="text" id="lastName" class="form-input w-full px-4 py-2 rounded-lg">
                    </div>
                </div>

                <div>
                    <label for="email" class="block text-sm font-medium text-gray-400 mb-1">Email</label>
                    <input type="email" id="email" class="form-input w-full px-4 py-2 rounded-lg">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="department" class="block text-sm font-medium text-gray-400 mb-1">Department</label>
                        <select id="department" class="form-input w-full px-4 py-2 rounded-lg">
                            <option value="">Select Department</option>
                            <option value="DevOps">DevOps</option>
                            <option value="Business">Business</option>
                            <option value="Marketing">Marketing</option>
                        </select>
                    </div>
                    <div>
                        <label for="position" class="block text-sm font-medium text-gray-400 mb-1">Job Title</label>
                        <input type="text" id="position" class="form-input w-full px-4 py-2 rounded-lg">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="joinDate" class="block text-sm font-medium text-gray-400 mb-1">Join Date</label>
                        <input type="date" id="joinDate" class="form-input w-full px-4 py-2 rounded-lg">
                    </div>
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-400 mb-1">Phone</label>
                        <input type="tel" id="phone" class="form-input w-full px-4 py-2 rounded-lg">
                    </div>
                </div>
                <div class="mb-4">
                    <label for="password" class="block text-gray-700 text-sm font-bold mb-2">Password</label>
                    <input type="password" id="password" name="password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="Enter password" autocomplete="new-password">
                </div>

                <div>
                    <label for="roles" class="block text-sm font-medium text-gray-400 mb-1">Role</label>
                    <select id="roles" class="form-input w-full px-4 py-2 rounded-lg">
                        <option value="">Select Role</option>
                        <option value="ROLE_USER">USER</option>
                        <option value="ROLE_USER_MANAGER">MANAGER</option>
                        <option value="ROLE_ADMIN">ADMIN</option>
                    </select>
                </div>



                <div class="pt-4 flex justify-end space-x-3">
                    <button type="button" onclick="closeAddEmployeeModal()" class="px-4 py-2 rounded-lg border border-gray-600 text-gray-300 hover:bg-gray-700">
                        Cancel
                    </button>
                    <button type="submit" class="btn-primary px-4 py-2 rounded-lg">
                        Add Employee
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal-overlay" id="employeeDetailsModal">
    <div class="modal-content">
        <div class="p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-orange-400">Employee Details</h3>
                <button onclick="closeEmployeeDetailsModal()" class="text-gray-400 hover:text-white">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>

            <div class="flex flex-col md:flex-row gap-6 mb-6">
                <div class="flex flex-col items-center">
                    <div class="employee-avatar w-24 h-24 mb-4" id="detailAvatar">JD</div>
                    <span class="text-xs px-2 py-1 rounded-full status-active mb-2" id="detailStatus">Active</span>
                    <div class="flex space-x-2">
                        <button class="action-btn bg-transparent hover:bg-orange-500 text-orange-400 hover:text-white py-1 px-3 border border-orange-500 rounded text-sm" onclick="editEmployeeDetails()">
                            <i class="bi bi-pencil-square mr-1"></i> Edit
                        </button>
                        <button class="action-btn bg-transparent hover:bg-red-500 text-red-400 hover:text-white py-1 px-3 border border-red-500 rounded text-sm" onclick="deleteEmployee()">
                            <i class="bi bi-trash mr-1"></i> Delete
                        </button>
                    </div>
                </div>

                <div class="flex-1">
                    <h4 class="text-lg font-semibold text-white mb-2" id="detailName">John Doe</h4>
                    <p class="text-gray-400 text-sm mb-4" id="detailJobTitle">Senior Developer | EMP001</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-gray-400 text-sm mb-1">Email</p>
                            <p class="text-white" id="detailEmail">john.doe@xammer.com</p>
                        </div>
                        <div>
                            <p class="text-gray-400 text-sm mb-1">Phone</p>
                            <p class="text-white" id="detailPhone">+1 (555) 123-4567</p>
                        </div>
                        <div>
                            <p class="text-gray-400 text-sm mb-1">Department</p>
                            <p class="text-white" id="detailDepartment">Development</p>
                        </div>
                        <div>
                            <p class="text-gray-400 text-sm mb-1">Join Date</p>
                            <p class="text-white" id="detailJoinDate">May 12, 2020</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="border-t border-gray-800 pt-4">
                <h5 class="text-md font-semibold text-orange-400 mb-3">Attendance Summary</h5>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <p class="text-gray-400 text-sm mb-1">Total Days</p>
                        <p class="text-white text-xl font-semibold" id="totalDays">245</p>
                    </div>
                    <div class="bg-gray-800 p-3 rounded-lg attendance-present">
                        <p class="text-gray-400 text-sm mb-1">Present</p>
                        <p class="text-white text-xl font-semibold" id="presentDays">230</p>
                    </div>
                    <div class="bg-gray-800 p-3 rounded-lg attendance-absent">
                        <p class="text-gray-400 text-sm mb-1">Absent</p>
                        <p class="text-white text-xl font-semibold" id="absentDays">15</p>
                    </div>
                </div>
            </div>

            <div class="pt-4 flex justify-end">
                <button onclick="closeEmployeeDetailsModal()" class="btn-primary px-4 py-2 rounded-lg">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>
<script>
    // Get CSRF token from meta tags
    const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
    const csrfHeaderName = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');
    const sidebar = document.querySelector('.sidebar');
    const sidebarOverlay = document.querySelector('.sidebar-overlay');
    const mainContent = document.querySelector('.main');
    const sidebarToggleButton = document.querySelector('.sidebar-toggle-button');

    // Current page for pagination
    let currentPage = 1;
    let totalPages = 1;
    let employees = []; // This will hold all fetched employees
    let filteredEmployees = []; // This will hold employees after search/filter

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
        fetchEmployees();
        // Removed the direct keyup listener for filterEmployees, as suggestUsers will handle it
    });

    function toggleSidebar() {
        sidebar.classList.toggle('open');
        sidebarOverlay.style.display = sidebar.classList.contains('open') ? 'block' : 'none';
        mainContent.classList.toggle('sidebar-open');
    }

    function closeSidebar() {
        sidebar.classList.remove('open');
        sidebarOverlay.style.display = 'none';
        mainContent.classList.remove('sidebar-open');
    }

    function confirmLogout() {
        return confirm("Are you sure you want to logout?");
    }

    // --- Fetch Employees from Backend (using findAll) ---
    function fetchEmployees() {
        console.log("Fetching employees from backend using /admin/employees/api...");

        fetch('/admin/employees/api', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    [csrfHeaderName]: csrfToken
                }
            })
            .then(response => {
                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        alert('Authentication failed or not authorized. Please log in again.');
                        window.location.href = '/login';
                    } else {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                }
                return response.json();
            })
            .then(data => {
                employees = data.map(user => {
                    const displayId = user.id;

                    return {
                        id: displayId,
                        internalId: user.id,
                        username: user.username,
                        firstName: user.firstName,
                        lastName: user.lastName,
                        email: user.email,
                        department: user.department,
                        jobTitle: user.jobTitle,
                        phone: user.phone,
                        joinDate: user.joiningDate,
                        presentDays: user.presentDays || 0,
                        absentDays: user.absentDays || 0,
                        totalDays: (user.presentDays || 0) + (user.absentDays || 0),
                        roles: user.roles
                    };
                });

                console.log("Employees array after fetching and mapping (check IDs):", employees);

                filteredEmployees = [...employees];
                renderEmployeeCards();
                updatePagination();
            })
            .catch(error => {
                console.error('Error fetching employees:', error);
                alert('Failed to load employee data. Please try again later.');
            });
    }

    // Render employee cards
    function renderEmployeeCards() {
        const container = document.getElementById('employeeCardsContainer');
        container.innerHTML = '';

        const itemsPerPage = 8;
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const employeesToRender = filteredEmployees.slice(startIndex, endIndex);

        if (employeesToRender.length === 0) {
            container.innerHTML = '<p class="text-center text-gray-500 text-lg py-10">No employees found matching your criteria.</p>';
            return;
        }

        employeesToRender.forEach(employee => {
            const card = document.createElement('div');
            card.className = 'employee-card p-6 cursor-pointer';
            card.onclick = () => {
                console.log("Card Clicked. Viewing details for employee.id:", employee.id);
                viewEmployeeDetails(employee.id);
            };

            const initials = employee.firstName.charAt(0) + employee.lastName.charAt(0);
            const joinDateObj = new Date(employee.joinDate);
            const joinDate = isNaN(joinDateObj.getTime()) ? 'N/A' : joinDateObj.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });

            card.innerHTML = `
                <div class="employee-avatar mb-4">${initials}</div>
                <h3 class="text-xl font-semibold text-white text-center mb-1">${employee.firstName} ${employee.lastName}</h3>
                <p class="text-gray-400 text-sm text-center mb-2">${employee.jobTitle}</p>
                <div class="flex justify-between items-center mb-3">
                    <span class="text-sm text-gray-400">${employee.id}</span>
                    <span class="text-xs px-2 py-1 rounded-full status-active">Active</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-gray-400">${employee.department}</span>
                    <span class="text-orange-400">Joined: ${joinDate}</span>
                </div>
            `;
            container.appendChild(card);
        });
    }

    // Search functionality variables
    let suggestionTimeout;
    let currentFocus = -1;
    const searchResultsList = document.getElementById('employeeSearchResults');
    const searchInput = document.getElementById('searchUser');

    function suggestUsers(searchText) {
        clearTimeout(suggestionTimeout);

        if (searchText.trim() === "") {
            searchResultsList.style.display = 'none';
            searchResultsList.innerHTML = '';
            currentFocus = -1;
            // When search box is empty, show all employees
            filteredEmployees = [...employees];
            currentPage = 1;
            renderEmployeeCards();
            updatePagination();
            return;
        }

        suggestionTimeout = setTimeout(() => {
            const results = employees.filter(emp =>
                emp.firstName.toLowerCase().includes(searchText.toLowerCase()) ||
                emp.lastName.toLowerCase().includes(searchText.toLowerCase()) ||
                emp.email.toLowerCase().includes(searchText.toLowerCase()) ||
                emp.id.toString().toLowerCase().includes(searchText.toLowerCase())
            );

            searchResultsList.innerHTML = '';
            currentFocus = -1;

            if (results.length > 0) {
                searchResultsList.style.display = 'block';
                results.slice(0, 5).forEach(employee => {
                    const listItem = document.createElement('li');
                    listItem.textContent = `${employee.firstName} ${employee.lastName} (${employee.id})`;
                    listItem.classList.add('px-4', 'py-2', 'cursor-pointer', 'hover:bg-orange-600', 'hover:text-white', 'rounded-md');
                    listItem.onclick = () => {
                        searchInput.value = `${employee.firstName} ${employee.lastName}`;
                        searchResultsList.style.display = 'none';
                        // Filter the employee cards to show just this selected employee
                        filteredEmployees = [employee];
                        currentPage = 1;
                        renderEmployeeCards();
                        updatePagination();
                    };
                    searchResultsList.appendChild(listItem);
                });
            } else {
                searchResultsList.innerHTML = '<li class="px-4 py-2 text-gray-400">No matching employees found</li>';
                searchResultsList.style.display = 'block';
            }
        }, 300); // Debounce time for suggestions
    }

    // Keyboard navigation for search suggestions
    searchInput.addEventListener("keydown", function(e) {
        const items = searchResultsList.getElementsByTagName("li");

        if (e.key === "ArrowDown") {
            currentFocus++;
            addActive(items);
            e.preventDefault(); // Prevent cursor from moving in input
        } else if (e.key === "ArrowUp") {
            currentFocus--;
            addActive(items);
            e.preventDefault(); // Prevent cursor from moving in input
        } else if (e.key === "Enter") {
            e.preventDefault();
            if (currentFocus > -1 && items[currentFocus]) {
                items[currentFocus].click(); // Simulate a click on the active item
            } else {
                // If no suggestion is selected, perform a general filter based on current input
                filterEmployees();
                searchResultsList.style.display = 'none'; // Hide suggestions after search
            }
        } else if (e.key === "Escape") { // Added Escape key to close suggestions
            searchResultsList.style.display = 'none';
            currentFocus = -1;
        }
    });

    // Close suggestions when clicking outside
    document.addEventListener("click", function(e) {
        if (!searchInput.contains(e.target) && !searchResultsList.contains(e.target)) {
            searchResultsList.style.display = 'none';
        }
    });


    function addActive(items) {
        if (!items) return;

        // Remove active class from all items
        for (let i = 0; i < items.length; i++) {
            items[i].classList.remove("bg-orange-600", "text-white");
        }

        // Add active class to current item
        if (currentFocus >= items.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = items.length - 1;

        if (items[currentFocus]) {
            items[currentFocus].classList.add("bg-orange-600", "text-white");
            items[currentFocus].scrollIntoView({
                block: "nearest"
            });
        }
    }

    function filterEmployees() {
        const searchText = document.getElementById('searchUser').value.toLowerCase();
        const department = document.getElementById('filterDepartment').value;

        // Ensure suggestions are hidden when the "Filter" button is explicitly used
        searchResultsList.style.display = 'none';


        filteredEmployees = employees.filter(employee => {
            const nameMatch = `${employee.firstName} ${employee.lastName}`.toLowerCase().includes(searchText) ||
                employee.email.toLowerCase().includes(searchText) ||
                employee.id.toString().toLowerCase().includes(searchText); // Filter by frontend ID
            const departmentMatch = department === '' || employee.department === department;

            return nameMatch && departmentMatch;
        });

        currentPage = 1;
        renderEmployeeCards();
        updatePagination();
    }

    // Pagination functions
    function changePage(direction) {
        if (direction === -1 && currentPage > 1) {
            currentPage--;
        } else if (direction === 1 && currentPage < totalPages) {
            currentPage++;
        }

        renderEmployeeCards();
        updatePagination();
    }

    function updatePagination() {
        const itemsPerPage = 8;
        totalPages = Math.ceil(filteredEmployees.length / itemsPerPage);

        const paginationContainer = document.querySelector('.inline-flex.rounded-md.shadow');
        paginationContainer.innerHTML = '';

        const prevButton = document.createElement('button');
        prevButton.className = 'pagination-btn px-3 py-1 rounded-l-md';
        prevButton.onclick = () => changePage(-1);
        prevButton.disabled = currentPage === 1;
        prevButton.innerHTML = '<i class="bi bi-chevron-left"></i>';
        paginationContainer.appendChild(prevButton);

        for (let i = 1; i <= totalPages; i++) {
            const pageButton = document.createElement('button');
            pageButton.className = `pagination-btn px-3 py-1 border-l border-gray-700 ${i === currentPage ? 'active' : ''}`;
            pageButton.textContent = i;
            pageButton.onclick = (function(page) {
                return function() {
                    currentPage = page;
                    renderEmployeeCards();
                    updatePagination();
                };
            })(i);
            paginationContainer.appendChild(pageButton);
        }

        const nextButton = document.createElement('button');
        nextButton.className = 'pagination-btn px-3 py-1 border-l border-gray-700 rounded-r-md';
        nextButton.onclick = () => changePage(1);
        nextButton.disabled = currentPage === totalPages;
        nextButton.innerHTML = '<i class="bi bi-chevron-right"></i>';
        paginationContainer.appendChild(nextButton);
    }

    // Modal functions
    function openAddEmployeeModal() {
        document.getElementById('addEmployeeModal').classList.add('active');
    }

    function closeAddEmployeeModal() {
        document.getElementById('addEmployeeModal').classList.remove('active');
        // Reset form and modal title/button when closing
        document.getElementById('addEmployeeForm').reset();
        document.getElementById('addEmployeeForm').removeAttribute('data-employee-id');
        document.getElementById('addEmployeeForm').removeAttribute('data-internal-id'); // Clear internal ID
        document.querySelector('#addEmployeeModal h3').textContent = 'Add New Employee';
        document.querySelector('#addEmployeeForm button[type="submit"]').textContent = 'Add Employee';
    }

    function viewEmployeeDetails(employeeId) {
        console.log("viewEmployeeDetails called with employeeId:", employeeId);
        const employee = employees.find(emp => emp.id === employeeId);
        if (!employee) {
            console.error("Employee not found in 'employees' array for ID:", employeeId);
            return;
        }
        console.log("Found employee object:", employee);

        const joinDateObj = new Date(employee.joinDate);
        const joinDate = isNaN(joinDateObj.getTime()) ? 'N/A' : joinDateObj.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });

        document.getElementById('detailAvatar').textContent =
            employee.firstName.charAt(0) + employee.lastName.charAt(0);
        document.getElementById('detailName').textContent =
            `${employee.firstName} ${employee.lastName}`;
        document.getElementById('detailJobTitle').textContent =
            `${employee.jobTitle} | ${employee.id}`;
        document.getElementById('detailEmail').textContent = employee.email;
        document.getElementById('detailPhone').textContent = employee.phone;
        document.getElementById('detailDepartment').textContent = employee.department;
        document.getElementById('detailJoinDate').textContent = joinDate;
        document.getElementById('totalDays').textContent = employee.totalDays;
        document.getElementById('presentDays').textContent = employee.presentDays;
        document.getElementById('absentDays').textContent = employee.absentDays;

        document.getElementById('employeeDetailsModal').setAttribute('data-employee-id', employee.id);
        document.getElementById('employeeDetailsModal').setAttribute('data-internal-id', employee.internalId);
        document.getElementById('employeeDetailsModal').classList.add('active');
    }

    function closeEmployeeDetailsModal() {
        document.getElementById('employeeDetailsModal').classList.remove('active');
    }

    function editEmployeeDetails() {
        console.log("editEmployeeDetails function called!");

        const employeeIdString = document.getElementById('employeeDetailsModal').getAttribute('data-employee-id');
        const internalIdString = document.getElementById('employeeDetailsModal').getAttribute('data-internal-id');

        const employeeId = parseInt(employeeIdString);
        const internalId = parseInt(internalIdString);

        console.log("Employee ID from modal (frontend - parsed):", employeeId);
        console.log("Internal ID from modal (backend - parsed):", internalId);

        if (isNaN(employeeId) || isNaN(internalId)) {
            console.error("Error: Employee ID or Internal ID is not a valid number.");
            return;
        }

        // Find the employee using the employeeId (which is the backend's ID)
        const employee = employees.find(emp => emp.id === employeeId);

        if (employee) {
            // Populate the add/edit employee modal with existing data
            document.getElementById('firstName').value = employee.firstName;
            document.getElementById('lastName').value = employee.lastName;
            document.getElementById('email').value = employee.email;
            document.getElementById('department').value = employee.department;
            document.getElementById('position').value = employee.jobTitle;
            document.getElementById('joinDate').value = employee.joinDate; // Date input expects YYYY-MM-DD
            document.getElementById('phone').value = employee.phone;
            document.getElementById('roles').value = employee.roles[0]; // Assuming one role for simplicity

            // Set the modal title and button text for editing
            document.querySelector('#addEmployeeModal h3').textContent = 'Edit Employee';
            document.querySelector('#addEmployeeForm button[type="submit"]').textContent = 'Save Changes';

            // Store the employee's ID on the form for submission
            document.getElementById('addEmployeeForm').setAttribute('data-employee-id', employee.id);
            document.getElementById('addEmployeeForm').setAttribute('data-internal-id', employee.internalId); // CRUCIAL for backend update

            // Open the modal
            openAddEmployeeModal();
            closeEmployeeDetailsModal(); // Close details modal after opening edit modal
        } else {
            console.error("Employee not found for editing with ID:", employeeId);
            alert("Error: Employee not found for editing.");
        }
    }


    // Handle Add/Edit Employee Form Submission
    document.getElementById('addEmployeeForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent default form submission

        const employeeId = document.getElementById('addEmployeeForm').getAttribute('data-employee-id');
        const internalId = document.getElementById('addEmployeeForm').getAttribute('data-internal-id'); // Get internal ID

        const isEditing = !!employeeId; // Check if employeeId exists for editing

        const employeeData = {
            id: isEditing ? internalId : null, // Use internalId for updates, null for new
            firstName: document.getElementById('firstName').value,
            lastName: document.getElementById('lastName').value,
            email: document.getElementById('email').value,
            department: document.getElementById('department').value,
            jobTitle: document.getElementById('position').value,
            joiningDate: document.getElementById('joinDate').value,
            phone: document.getElementById('phone').value,
            password: document.getElementById('password').value,
            roles: [document.getElementById('roles').value]
        };

        let url = '/admin/employees/add'; // Default for adding
        let method = 'POST';

        if (isEditing) {
            url = `/admin/employees/update/${internalId}`; // Use internalId for update endpoint
            method = 'PUT';
        }

        fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                    [csrfHeaderName]: csrfToken
                },
                body: JSON.stringify(employeeData)
            })
            .then(response => {
                if (!response.ok) {
                    // Check for specific error status codes
                    if (response.status === 400) {
                        return response.json().then(err => {
                            throw new Error(err.message || 'Validation failed. Please check your input.');
                        });
                    } else if (response.status === 401 || response.status === 403) {
                        alert('Authentication failed or not authorized. Please log in again.');
                        window.location.href = '/login';
                        throw new Error('Unauthorized'); // Stop further processing
                    } else {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                }
                return response.json();
            })
            .then(data => {
                alert(`Employee ${isEditing ? 'updated' : 'added'} successfully!`);
                closeAddEmployeeModal();
                fetchEmployees(); // Re-fetch all employees to update the list
            })
            .catch(error => {
                console.error(`Error ${isEditing ? 'updating' : 'adding'} employee:`, error);
                alert(`Failed to ${isEditing ? 'update' : 'add'} employee: ${error.message || 'An unexpected error occurred.'}`);
            });
    });

    function deleteEmployee() {
        const employeeIdString = document.getElementById('employeeDetailsModal').getAttribute('data-employee-id');
        const internalIdString = document.getElementById('employeeDetailsModal').getAttribute('data-internal-id');
        const employeeName = document.getElementById('detailName').textContent;

        const employeeId = parseInt(employeeIdString);
        const internalId = parseInt(internalIdString);

        if (isNaN(employeeId) || isNaN(internalId)) {
            console.error("Error: Employee ID or Internal ID is not a valid number for deletion.");
            return;
        }

        if (confirm(`Are you sure you want to delete employee: ${employeeName} (ID: ${employeeId})? This action cannot be undone.`)) {
            fetch(`/admin/employees/delete/${internalId}`, { // Use internalId for deletion
                    method: 'DELETE',
                    headers: {
                        [csrfHeaderName]: csrfToken
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        if (response.status === 401 || response.status === 403) {
                            alert('Authentication failed or not authorized. Please log in again.');
                            window.location.href = '/login';
                            throw new Error('Unauthorized');
                        } else {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                    }
                    alert('Employee deleted successfully!');
                    closeEmployeeDetailsModal();
                    fetchEmployees(); // Re-fetch employees to update the list
                })
                .catch(error => {
                    console.error('Error deleting employee:', error);
                    alert('Failed to delete employee. Please try again.');
                });
        }
    }
</script>